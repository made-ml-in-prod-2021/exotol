### Hello World! 

В проекте используется `docker`, `docker-compose`. Последним удобнее работать 
особенно на `Windows`.

Для запуска нужно заполнить 2 переменные окружения в Dockerfile:
- PATH_TO_MODEL
- PORT

Затем нужно выполнить 
~~~
docker-compose up --build
~~~
На PORT будет поднят сервер в докере.
Если Windows 8.1 и ниже, то достучаться можно по IP виртуальной машины 
`192.168.99.100:PORT/`, а иначе можно стучать на прямую
`127.0.0.1:PORT/

Для оптимизации размера использовался:
- [multi-stage build](https://pythonspeed.com/articles/multi-stage-docker-python/)
- выбор подходящего образа

Изначальный размер

| REPOSITORY   | TAG  | IMAGE ID  | CREATED  | SIZE  |
|--------------|------|-----------|----------|-------|
| exotol/heart_disease_app | latest  | 709471c660d8  | About an hour ago | 607MB  |

После применения multi-stage build 

| REPOSITORY   | TAG  | IMAGE ID  | CREATED  | SIZE  |
|--------------|------|-----------|----------|-------|
| exotol/heart_disease_app | latest  | 7a6585a86c1a  | 10 seconds ago | 526MB  |

Изначально использовался `python:3.9-slim` (размеры выше были замерены на нем)
Потом заменил на `python:slim-buster` и удалось еще сократить размер 

| REPOSITORY   | TAG  | IMAGE ID  | CREATED  | SIZE  |
|--------------|------|-----------|----------|-------|
| exotol/heart_disease_app | latest  | 4883992dfa57  | 10 seconds ago | 468MB  |

Запуск
Предлагаю для единообразия и простоты запуска использовать docker-compose
Если хотим локально собрать докер, то `docker-compose.yaml`, 
должен иметь `build: .`  
~~~
services:
    web-app:
      image: exotol/heart_disease_app:latest
      build: .
      ports:
        - "9000:8000"
~~~

Если мы хотим использовать собранный образ, то `build: .` нужно убрать

~~~
services:
    web-app:
      image: exotol/heart_disease_app:latest
      ports:
        - "9000:8000"
~~~

останется в консоле, в папке где лежит docker-compose.yaml набрать
`docker-compose up` докер сделает все остальное (т.е. будет выкачан образ с 
docker.hub и запущен контейнер с указанными настройками)

Интеграционный тест можно выполнить, зайдя в `command`
и запустив `run_integration_test.cmd`
Сейчас скрипт настроен на тестировании под windows 8.1 и ниже, т.е. считаем
что докер работает на машине 192.168.99.100


Репозиторий https://data.mail.ru/profile/a.bardakov/ для курса ML in Production

~~0) ветку назовите homework2, положите код в папку online_inference~~

~~1) Оберните inference вашей модели в rest сервис(вы можете использовать как FastAPI, так и flask, другие желательно не использовать, дабы не плодить излишнего разнообразия для проверяющих), должен быть endpoint /predict (3 балла)~~

~~2) Напишите тест для /predict (3 балла) (https://fastapi.tiangolo.com/tutorial/testing/, https://flask.palletsprojects.com/en/1.1.x/testing/)~~

~~3) Напишите скрипт, который будет делать запросы к вашему сервису -- 2 балла~~

~~4) Сделайте валидацию входных данных (например, порядок колонок не совпадает с трейном, типы не те и пр, в рамках вашей фантазии)  (вы можете сохранить вместе с моделью доп информацию, о структуре входных данных, если это нужно) -- 3 доп балла
https://fastapi.tiangolo.com/tutorial/handling-errors/ -- возращайте 400, в случае, если валидация не пройдена~~

~~5) Напишите dockerfile, соберите на его основе образ и запустите локально контейнер(docker build, docker run), внутри контейнера должен запускать сервис, написанный в предущем пункте, закоммитьте его, напишите в readme корректную команду сборки (4 балл)~~

~~6) Оптимизируйте размер docker image (3 доп балла) (опишите в readme.md что вы предприняли для сокращения размера и каких результатов удалось добиться)  -- https://docs.docker.com/develop/develop-images/dockerfile_best-practices/~~

~~7) опубликуйте образ в https://hub.docker.com/, используя docker push (вам потребуется зарегистрироваться) (2 балла)~~

~~8) напишите в readme корректные команды docker pull/run, которые должны привести к тому, что локально поднимется на inference ваша модель (1 балл)
Убедитесь, что вы можете протыкать его скриптом из пункта 3~~

~~5) проведите самооценку -- 1 доп балл~~
~~6) создайте пулл-реквест и поставьте label -- hw2~~

Самооценка
Было переделано 1ое дз под удобства проекта hw2
Формально выполнены все пункты дз т.е. 22 балла + 3 балла (получил от Михаила за статью)
